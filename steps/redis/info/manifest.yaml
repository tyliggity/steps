apiVersion: stackpulse.io/v1
kind: Step
metadata:
  version: 1.0.0
  name: "redis_info"
  description: "Display Redis server info"
  vendor: redis
  type: hydration

envs:
  - name: REDIS_IP 
    description: "Destination redis IP address (required)"
    type: "string"
    required: true
    example: "127.0.0.1"
  - name: REDIS_PASSWORD
    description: "Destination redis password (optional)"
    type: "string"
    example: '{{ secret "REDIS_PASSWORD" }}'
  - name: REDIS_URL 
    description: "Redis url (required if there is no redis IP address specified)"
    type: "string"
    example: "redis://<username>:<password>@<host>:<port>/<database>"

outputs:
  - name: info
    description: "Information and statistics about the server, sectioned by topics."
    type: "json"
    example: '{"CPU": {"used_cpu_sys": "2065.952170","used_cpu_sys_children": "0.001484","used_cpu_user": "2314.815457","used_cpu_user_children": "0.000000"},"Clients": {"blocked_clients": "0","client_recent_max_input_buffer": "8","client_recent_max_output_buffer": "0","clients_in_timeout_table": "0","connected_clients": "2","tracking_clients": "0"},"Cluster": {"cluster_enabled": "0"},"Keyspace": {"db0": "keys=2,expires=0,avg_ttl=0"},"Memory": {"active_defrag_running": "0","allocator_active": "1146880","allocator_allocated": "891344","allocator_frag_bytes": "255536","allocator_frag_ratio": "1.29","allocator_resident": "3510272","allocator_rss_bytes": "2363392","allocator_rss_ratio": "3.06","lazyfree_pending_objects": "0","maxmemory": "0","maxmemory_human": "0B","maxmemory_policy": "noeviction","mem_allocator": "jemalloc-5.1.0","mem_aof_buffer": "0","mem_clients_normal": "20512","mem_clients_slaves": "0","mem_fragmentation_bytes": "1951336","mem_fragmentation_ratio": "3.27","mem_not_counted_for_evict": "0","mem_replication_backlog": "0","number_of_cached_scripts": "0","rss_overhead_bytes": "-700416","rss_overhead_ratio": "0.80","total_system_memory": "2093187072","total_system_memory_human": "1.95G","used_memory": "922032","used_memory_dataset": "98256","used_memory_dataset_perc": "82.65%","used_memory_human": "900.42K","used_memory_lua": "37888","used_memory_lua_human": "37.00K","used_memory_overhead": "823776","used_memory_peak": "941096","used_memory_peak_human": "919.04K","used_memory_peak_perc": "97.97%","used_memory_rss": "2809856","used_memory_rss_human": "2.68M","used_memory_scripts": "0","used_memory_scripts_human": "0B","used_memory_startup": "803152"},"Modules": {},"Persistence": {"aof_current_rewrite_time_sec": "-1","aof_enabled": "0","aof_last_bgrewrite_status": "ok","aof_last_cow_size": "0","aof_last_rewrite_time_sec": "-1","aof_last_write_status": "ok","aof_rewrite_in_progress": "0","aof_rewrite_scheduled": "0","loading": "0","module_fork_in_progress": "0","module_fork_last_cow_size": "0","rdb_bgsave_in_progress": "0","rdb_changes_since_last_save": "0","rdb_current_bgsave_time_sec": "-1","rdb_last_bgsave_status": "ok","rdb_last_bgsave_time_sec": "0","rdb_last_cow_size": "249856","rdb_last_save_time": "1607932785"},"Replication": {"connected_slaves": "0","master_repl_offset": "0","master_replid": "*****************************************","master_replid2": "0000000000000000000000000000000000000000","repl_backlog_active": "0","repl_backlog_first_byte_offset": "0","repl_backlog_histlen": "0","repl_backlog_size": "1048576","role": "master","second_repl_offset": "-1"},"Server": {"arch_bits": "64","atomicvar_api": "atomic-builtin","config_file": "","configured_hz": "10","executable": "/data/redis-server","gcc_version": "8.3.0","hz": "10","io_threads_active": "0","lru_clock": "464786","multiplexing_api": "epoll","os": "*******************","process_id": "1","redis_build_id": "11509227cb1fdf31","redis_git_dirty": "0","redis_git_sha1": "00000000","redis_mode": "standalone","redis_version": "6.0.9","run_id": "019c8415a48262d3a92ac0eaa42231023da73e0f","tcp_port": "6379","uptime_in_days": "36","uptime_in_seconds": "3148338"},"Stats": {"active_defrag_hits": "0","active_defrag_key_hits": "0","active_defrag_key_misses": "0","active_defrag_misses": "0","evicted_keys": "0","expire_cycle_cpu_milliseconds": "64712","expired_keys": "0","expired_stale_perc": "0.00","expired_time_cap_reached_count": "0","instantaneous_input_kbps": "0.00","instantaneous_ops_per_sec": "0","instantaneous_output_kbps": "0.00","io_threaded_reads_processed": "0","io_threaded_writes_processed": "0","keyspace_hits": "129","keyspace_misses": "2","latest_fork_usec": "568","migrate_cached_sockets": "0","pubsub_channels": "0","pubsub_patterns": "0","rejected_connections": "0","slave_expires_tracked_keys": "0","sync_full": "0","sync_partial_err": "0","sync_partial_ok": "0","total_commands_processed": "939","total_connections_received": "404","total_net_input_bytes": "29265","total_net_output_bytes": "607784","total_reads_processed": "1277","total_writes_processed": "874","tracking_total_items": "0","tracking_total_keys": "0","tracking_total_prefixes": "0","unexpected_error_replies": "0"},}'
  - name: multiline
    description: "Raw, unparsed output of the redis command."
    type: "json"
    example: |
      # Server\r\nredis_version:6.0.9\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:********************************\r\nredis_mode:standalone\r\nos:Linux ******* x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:8.3.0\r\nprocess_id:1\r\nrun_id:*************************\r\ntcp_port:6379\r\nuptime_in_seconds:3148338\r\nuptime_in_days:36\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:464786\r\nexecutable:/data/redis-server\r\nconfig_file:\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:2\r\nclient_recent_max_input_buffer:8\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:922032\r\nused_memory_human:900.42K\r\nused_memory_rss:2809856\r\nused_memory_rss_human:2.68M\r\nused_memory_peak:941096\r\nused_memory_peak_human:919.04K\r\nused_memory_peak_perc:97.97%\r\nused_memory_overhead:823776\r\nused_memory_startup:803152\r\nused_memory_dataset:98256\r\nused_memory_dataset_perc:82.65%\r\nallocator_allocated:891344\r\nallocator_active:1146880\r\nallocator_resident:3510272\r\ntotal_system_memory:2093187072\r\ntotal_system_memory_human:1.95G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.29\r\nallocator_frag_bytes:255536\r\nallocator_rss_ratio:3.06\r\nallocator_rss_bytes:2363392\r\nrss_overhead_ratio:0.80\r\nrss_overhead_bytes:-700416\r\nmem_fragmentation_ratio:3.27\r\nmem_fragmentation_bytes:1951336\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:20512\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1607932785\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:249856\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:404\r\ntotal_commands_processed:939\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:29265\r\ntotal_net_output_bytes:607784\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:64712\r\nevicted_keys:0\r\nkeyspace_hits:129\r\nkeyspace_misses:2\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:568\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:1277\r\ntotal_writes_processed:874\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:********************************\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:2065.952170\r\nused_cpu_user:2314.815457\r\nused_cpu_sys_children:0.001484\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=2,expires=0,avg_ttl=0\r\n",







